include "basic_2/rt_transition/cpm_drops.ma".
include "basic_2/rt_transition/cpr.ma".
(*
theorem cpm_cpm_trans_swap (h) (G) (L) (T1):
        ‚àÄn1,T. ‚¶ÉG,L‚¶Ñ ‚ä¢ T1 ‚û°[n1,h] T ‚Üí ‚àÄn2,T2. ‚¶ÉG,L‚¶Ñ ‚ä¢ T ‚û°[n2,h] T2 ‚Üí n1 ‚â§ n2 ‚Üí
        ‚àÉ‚àÉT0. ‚¶ÉG,L‚¶Ñ ‚ä¢ T1 ‚û°[n2,h] T0 & ‚¶ÉG,L‚¶Ñ ‚ä¢ T0 ‚û°[n1,h] T2.
#h #G #L #T1 #n1 #T #H
@(cpm_ind ‚Ä¶ H) -n1 -G -L -T1 -T
[ #I #G #L #n2 #T2 #HT2 #_ /2 width=3 by ex2_intro/
| #G #L #s #n2 #X2 #H #_
  elim (cpm_inv_sort1 ‚Ä¶ H) -H #H #Hn2 destruct >iter_n_Sm
  /3 width=3 by cpm_sort, ex2_intro/
| #n1 #G #K #V1 #V #W #_ #IH #HVW #n2 #T2 #HT2 #Hn
  elim (cpm_inv_lifts_sn ‚Ä¶ HT2 (‚ìâ) ‚Ä¶ HVW) -W
  [|*: /3 width=2 by drops_refl, drops_drop/ ] #V2 #HVT2 #HV2
  elim (IH ‚Ä¶ HV2) -V [| // ] #V0 #HV10 #HV02
  elim (lifts_total V0 (ùêî‚ù¥1‚ùµ)) #T0 #HVT0
  lapply (cpm_lifts_bi ‚Ä¶ HV02 (‚ìâ) ‚Ä¶ (K.‚ììV1) ‚Ä¶ HVT0 ‚Ä¶ HVT2) -V2
  [ /3 width=2 by drops_refl, drops_drop/ ] #HT02
  /3 width=3 by cpm_delta, ex2_intro/
| #n1 #G #K #V1 #V #W #_ #IH #HVW #m2 #T2 #HT2 #H
  elim (le_inv_S1 ‚Ä¶ H) -H #n2 #Hn #H destruct
  elim (cpm_inv_lifts_sn ‚Ä¶ HT2 (‚ìâ) ‚Ä¶ HVW) -W
  [|*: /3 width=2 by drops_refl, drops_drop/ ] #V2 #HVT2 #HV2
  elim (IH ‚Ä¶ HV2) -V [| /2 width=1 by le_S/ ] #V0 #HV10 #HV02
  elim (lifts_total V0 (ùêî‚ù¥1‚ùµ)) #T0 #HVT0
  lapply (cpm_lifts_bi ‚Ä¶ HV02 (‚ìâ) ‚Ä¶ (K.‚ìõV1) ‚Ä¶ HVT0 ‚Ä¶ HVT2) -V2
  [ /3 width=2 by drops_refl, drops_drop/ ] #HT02
  /3 width=5 by cpm_ell, ex2_intro/
*)

(* Note: cpm_cpm_trans_swap does not hold: take L = K.‚ìõV1, T1 = #0, n2 = 0 *)
theorem cpr_cpm_trans_swap (h) (G) (L):
        ‚àÄT1,T. ‚¶ÉG,L‚¶Ñ ‚ä¢ T1 ‚û°[h] T ‚Üí ‚àÄn2,T2. ‚¶ÉG,L‚¶Ñ ‚ä¢ T ‚û°[n2,h] T2 ‚Üí
        ‚àÉ‚àÉT0. ‚¶ÉG,L‚¶Ñ ‚ä¢ T1 ‚û°[n2,h] T0 & ‚¶ÉG,L‚¶Ñ ‚ä¢ T0 ‚û°[h] T2.
#h #G #L #T1 #T #H
@(cpr_ind ‚Ä¶ H) -G -L -T1 -T
[ #I #G #L #n2 #T2 #HT2 /2 width=3 by ex2_intro/
| #G #K #V1 #V #W #_ #IH #HVW #n2 #T2 #HT2
  elim (cpm_inv_lifts_sn ‚Ä¶ HT2 (‚ìâ) ‚Ä¶ HVW) -W
  [|*: /3 width=2 by drops_refl, drops_drop/ ] #V2 #HVT2 #HV2
  elim (IH ‚Ä¶ HV2) -V #V0 #HV10 #HV02
  elim (lifts_total V0 (ùêî‚ù¥1‚ùµ)) #T0 #HVT0
  lapply (cpm_lifts_bi ‚Ä¶ HV02 (‚ìâ) ‚Ä¶ (K.‚ììV1) ‚Ä¶ HVT0 ‚Ä¶ HVT2) -V2
  [ /3 width=2 by drops_refl, drops_drop/ ] #HT02
  /3 width=3 by cpm_delta, ex2_intro/
| #I #G #K #T #U #i #_ #IH #HTU #n2 #U2 #HU2
  elim (cpm_inv_lifts_sn ‚Ä¶ HU2 (‚ìâ) ‚Ä¶ HTU) -U
  [|*: /3 width=2 by drops_refl, drops_drop/ ] #T2 #HTU2 #HT2
  elim (IH ‚Ä¶ HT2) -T #T0 #HT0 #HT02
  elim (lifts_total T0 (ùêî‚ù¥1‚ùµ)) #U0 #HTU0
  lapply (cpm_lifts_bi ‚Ä¶ HT02 (‚ìâ) ‚Ä¶ (K.‚ìò{I}) ‚Ä¶ HTU0 ‚Ä¶ HTU2) -T2
  [ /3 width=2 by drops_refl, drops_drop/ ] #HU02
  /3 width=3 by cpm_lref, ex2_intro/
| #p #I #G #L #V1 #V #T1 #T #_ #_ #IHV #IHT #n2 #X2 #H
  elim (cpm_inv_bind1 ‚Ä¶ H) -H *
  [ #V2 #T2 #HV2 #HT2 #H destruct 