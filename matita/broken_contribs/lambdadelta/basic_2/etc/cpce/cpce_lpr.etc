include "basic_2/rt_transition/lpr.ma".
include "basic_2/rt_conversion/lpce.ma".
include "basic_2/dynamic/cnv_preserve.ma".

lemma cpce_cpm_conf_lpce_lpr (a) (h) (n) (G):
      ‚àÄL1,T1. ‚¶ÉG,L1‚¶Ñ ‚ä¢ T1 ![a,h] ‚Üí
      ‚àÄU1. ‚¶ÉG,L1‚¶Ñ ‚ä¢ T1 ‚¨åŒ∑[h] U1 ‚Üí ‚àÄK1. ‚¶ÉG,L1‚¶Ñ ‚ä¢ ‚¨åŒ∑[h] K1 ‚Üí
      ‚àÄT2. ‚¶ÉG,L1‚¶Ñ ‚ä¢ T1 ‚û°[n,h] T2 ‚Üí ‚àÄL2. ‚¶ÉG,L1‚¶Ñ ‚ä¢ ‚û°[h] L2 ‚Üí
      ‚àÉ‚àÉK2,U2.  ‚¶ÉG,K1‚¶Ñ ‚ä¢ ‚û°[h] K2 & ‚¶ÉG,L2‚¶Ñ ‚ä¢ ‚¨åŒ∑[h] K2 & ‚¶ÉG,K2‚¶Ñ ‚ä¢ U1 ‚û°[n,h] U2 & ‚¶ÉG,L2‚¶Ñ ‚ä¢ T2 ‚¨åŒ∑[h] U2.
#a #h #n #G #L1 #T1 #HT1
letin o ‚âù (sd_O h)
lapply (cnv_fwd_fsb ‚Ä¶ o ‚Ä¶ HT1) -HT1 #H
@(fsb_ind_fpbg ‚Ä¶ H) -G -L1 -T1 #G #L1 #T1 #_ #IH
#U1 

#H elim H -G -L1 -T1 -U1
[ #G #L1 elim L1 -L1 [| #L1 #I1 #IH ] #s #K1 #HLK1 #X2 #HX2 #Y2 #HY2
  elim (cpm_inv_sort1 ‚Ä¶ HX2) -HX2 #H #Hn destruct
  [ lapply (lpr_inv_atom_sn ‚Ä¶ HY2) -HY2 #H destruct
    lapply (lpce_inv_atom_sn ‚Ä¶ HLK1) -HLK1 #H destruct
    /3 width=6 by cpce_sort, cpm_sort, ex4_2_intro/
  | elim (lpr_inv_bind_sn ‚Ä¶ HY2) -HY2 #I2 #L2 #HL12 #HI12 #H destruct
    elim (lpce_inv_bind_sn ‚Ä¶ HLK1) -HLK1 #J1 #K0 #HLK1 #HIJ1 #H destruct
    elim (IH s ? HLK1 (‚ãÜ((next h)^n s)) ‚Ä¶ HL12) -IH -HLK1 -HL12
    [| /2 width=1 by cpm_sort/ ] #K2 #U2 #HK12 #HLK2 #H1s #H2s

| #G #L1 #s elim L1 -L1
  [ #Y2 #HY2 #X2 #HX2 #K1 #HLK1
    lapply (cpce_inv_sort_sn ‚Ä¶ HX2) -HX2 #H destruct
    /3 width=6 by cpce_sort, ex4_2_intro/
  | #L1 #I1 #IH #Y2 #HY2 #X2 #HX2 #K1 #HLK1
    lapply (cpce_inv_sort_sn ‚Ä¶ HX2) -HX2 #H destruct

    
| #n #G #K1 #V1 #V2 #X1 #HV12 #_ #HX1 #X2 #HX2 #Y2 #HY2
  elim (lpr_inv_pair_sn ‚Ä¶ HY2) -HY2 #K2 #W1 #HK12 #HVW1 #H destruct
  lapply (cpce_inv_ldef_sn ‚Ä¶ HX2) -HX2 #H destruct
  elim (lifts_total W1 (ùêî‚ù¥1‚ùµ)) #X2 #HX2
  @(ex2_intro ‚Ä¶ X2) [ @(cpm_delta ‚Ä¶ HX2) /3 width=5 by _/
  
  /3 width=3 by cpce_ldef, ex2_intro/
  | 